{"filter":false,"title":"script.js","tooltip":"/script.js","undoManager":{"mark":1,"position":1,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":0,"column":54},"action":"remove","lines":["// Marija Novak = 4806e72a-a5b1-4f88-ac15-db84fd8cd195"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":425,"column":0},"action":"remove","lines":["","var baseUrl = 'https://rest.ehrscape.com/rest/v1';","var queryUrl = baseUrl + '/query';","","var username = \"ois.seminar\";","var password = \"ois4fri\";","","var listOfCountries = [];","var recentDiseases = [];","","function getSessionId() {","    var response = $.ajax({","        type: \"POST\",","        url: baseUrl + \"/session?username=\" + encodeURIComponent(username) +","                \"&password=\" + encodeURIComponent(password),","        async: false","    });","    return response.responseJSON.sessionId;","}","","function kreirajEHR()  {","\tsessionId = getSessionId();","\t","\tvar ime = $(\"#ime\").val();","\tvar priimek = $(\"#priimek\").val();","\tvar datumRojstva = $(\"#datumRojstva\").val();","\tvar casRojstva = $(\"#casRojstva\").val();","\tvar spol = $('input:radio[name=gender]').filter(\":checked\").val();","","\tif (!ime || !priimek || !datumRojstva || !casRojstva || ime.trim().length == 0 || priimek.trim().length == 0 || datumRojstva.trim().length == 0 || casRojstva.trim().length == 0) {","\t\t$(\"#sporociloVnosEHR\").html(\"<span class='obvestilo label label-danger'>Izpolnite vsa polja!</span>\");","\t\treturn false;","\t}","\telse","\t{","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\t$.ajax({","\t\t    url: baseUrl + \"/ehr\",","\t\t    type: 'POST',","\t\t    success: function (data) {","\t\t        var ehrId = data.ehrId;","\t\t        var partyData = {","\t\t            firstNames: ime,","\t\t            lastNames: priimek,","\t\t            gender:spol + \"\",","\t\t            dateOfBirth: datumRojstva+\"T\"+casRojstva,","\t\t            partyAdditionalInfo: [{key: \"ehrId\", value: ehrId}]","\t\t        };","\t\t        $.ajax({","\t\t            url: baseUrl + \"/demographics/party\",","\t\t            type: 'POST',","\t\t            contentType: 'application/json',","\t\t            data: JSON.stringify(partyData),","\t\t            success: function (party) {","\t\t                if (party.action == 'CREATE') {","\t\t                    $(\"#obvestiloEHR\").html('<div class=\"alert alert-success\" role=\"alert\">Uspešno kreiran EHR: ' + ehrId + '</div>');","\t\t                    $(\"#ehrID\").val(ehrId);","\t\t                }","\t\t                return true;","\t\t            },","\t\t            error: function(err) {","\t\t            \t$(\"#obvestiloEHR\").html('<div class=\"alert alert-danger\" role=\"alert\"> Napaka pri ustvarjanju EHR: ' + JSON.parse(err.responseText).userMessage + \"!\");","\t\t            \treturn false;","\t\t            }","\t\t        });","\t\t    }","\t\t});","\t}","}","","function preberiEHR() {","\tsessionId = getSessionId();","","\tvar ehrId = $(\"#pacientEHR\").val();","\tif (!ehrId || ehrId.trim().length == 0) $(\"#obvestiloEHR\").html('<div class=\"alert alert-warning\" role=\"alert\"> Vnesite vse zahtevane podatke!</div>');","\telse ","\t{","\t\t$.ajax({","\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",","\t\t\ttype: 'GET',","\t\t\theaders: {\"Ehr-Session\": sessionId},","\t    \tsuccess: function (data) {","\t\t\t\tvar podatki = data.party;","\t\t\t\tvar starost = getAge(podatki.dateOfBirth);","\t\t\t\tvar spol = podatki.gender == \"MALE\" ? \"Moški\" : \"Ženska\";","\t\t\t\t$(\"#ime\").html(\"<strong>\" + podatki.firstNames + \"</strong>\");","\t\t\t\t$(\"#priimek\").html(\"<strong>\" + podatki.lastNames + \"</strong>\");","\t\t\t\t$(\"#spol\").html(\"<strong>\" + spol + \"</strong>\");","\t\t\t\t$(\"#starost\").html(\"<strong>\" + starost + \"</strong>\");","\t\t\t\t$(\"#obvestiloEHR\").html(\"\");","\t\t\t\t$(\"#kartoteka\").slideDown();","\t\t\t\t$(\"#diagnoza\").slideDown();","\t\t\t\tpreberiMeritve(ehrId);","\t\t\t},","\t\t\terror: function(err) {","\t\t\t\t$(\"#obvestiloEHR\").html('<div class=\"alert alert-danger\" role=\"alert\"> Napaka pri branju EHR: ' + JSON.parse(err.responseText).userMessage + \"!\");","\t\t\t\t$(\"#kartoteka\").hide();","\t\t\t}","\t\t});","\t}","}","","function vnosVitalnihPodatkov()","{","\tsessionId = getSessionId();","\t","\tvar ehrId = $(\"#pacientEHR\").val();","\tvar temperatura = $(\"#temperatura\").val();","\tvar teza = $(\"#teza\").val();","\tvar visina = $(\"#visina\").val();","\tvar tlak = $(\"#tlak\").val().split(\"/\");","\tvar merilec = $(\"#merilec\").val();","\tvar datumMeritve = $(\"#datumMeritve\").val();","\tvar casMeritve = $(\"#casMeritve\").val();","","\t// Če merilec ni podan je to bolnik sam","\tif (merilec.trim().length == 0 || !merilec) merilec = ehrId;","","\tvar sistolicniTlak = tlak[0];","\tvar diastolicniTlak = tlak[1];","","","\tif (!ehrId ||","\t !temperatura ||","\t  !teza || ","\t  !visina || ","\t  !tlak || ","\t  ehrId.trim().length == 0 || ","\t  datumMeritve.trim().length == 0 || ","\t  !datumMeritve || ","\t  !casMeritve || ","\t  casMeritve.trim().length == 0 || ","\t  temperatura.trim().length == 0 || ","\t  teza.trim().length == 0 || ","\t  visina.trim().length == 0) {","\t\t$(\"#sporociloVnosVitalnihPodatkov\").html(\"<span class='obvestilo label label-danger'>Izpolnite vsa polja!</span>\");","\t}","\telse {","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","","\t\tvar podatki = {","\t\t    \"ctx/language\": \"en\",","\t\t    \"ctx/territory\": \"SI\",","\t\t    \"ctx/time\": datumMeritve+\"T\"+casMeritve,","\t\t    \"vital_signs/height_length/any_event/body_height_length\": visina,","\t\t    \"vital_signs/body_weight/any_event/body_weight\": teza,","\t\t   \t\"vital_signs/body_temperature/any_event/temperature|magnitude\": temperatura,","\t\t    \"vital_signs/body_temperature/any_event/temperature|unit\": \"°C\",","\t\t    \"vital_signs/blood_pressure/any_event/systolic\": sistolicniTlak,","\t\t    \"vital_signs/blood_pressure/any_event/diastolic\": diastolicniTlak","\t\t};","","\t\tvar parametri = {","\t\t    \"ehrId\": ehrId,","\t\t    templateId: 'Vital Signs',","\t\t    format: 'FLAT',","\t\t    committer: merilec","\t\t};","\t\t$.ajax({","\t\t    url: baseUrl + \"/composition?\" + $.param(parametri),","\t\t    type: 'POST',","\t\t    contentType: 'application/json',","\t\t    data: JSON.stringify(podatki),","\t\t    success: function (res) {","\t\t        $(\"#obvestiloVitalnihZnakov\").html('<div class=\"alert alert-success\" role=\"alert\">Meritve so bile uspešno vnesene</div>');","\t\t    },","\t\t    error: function(err) {","\t\t    \t$(\"#obvestiloVitalnihZnakov\").html('<div class=\"alert alert-danger\" role=\"alert\"> Napaka pri branju EHR: ' + JSON.parse(err.responseText).userMessage + \"!\");","\t\t    }","\t\t});","\t}","}","","function preberiMeritve(ehrId)","{","\tsessionId = getSessionId();\t","","\tvar AQL = ","\t\t\t\"select \" +","\t\t    \"a_a/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude as temperatura, \"+","\t\t    \"a_d/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude as sis_tlak, \"+","\t\t    \"a_d/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude as dias_tlak, \"+","\t\t    \"a_b/data[at0002]/events[at0003]/data[at0001]/items[at0004, 'Body weight']/value/magnitude as teza, \"+","\t\t    \"a_c/data[at0001]/events[at0002]/data[at0003]/items[at0004, 'Body Height/Length']/value/magnitude as visina \"+","\t\t\t\"from EHR e[ehr_id/value='\" + ehrId+ \"'] \"+","\t\t\t\"contains COMPOSITION a \"+","\t\t\t\"contains ( \"+","\t\t\t    \"OBSERVATION a_a[openEHR-EHR-OBSERVATION.body_temperature.v1] and \"+","\t\t\t    \"OBSERVATION a_b[openEHR-EHR-OBSERVATION.body_weight.v1] and \"+","\t\t\t    \"OBSERVATION a_c[openEHR-EHR-OBSERVATION.height.v1] and \"+","\t\t\t    \"OBSERVATION a_d[openEHR-EHR-OBSERVATION.blood_pressure.v1]) \"+","\t\t\t\"order by a/context/start_time desc \"+","\t\t\t\"offset 0 limit 1 \";","\t\t$.ajax({","\t\t    url: baseUrl + \"/query?\" + $.param({\"aql\": AQL}),","\t\t    type: 'GET',","\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t    success: function (rezultatAQL) {","\t\t    \tif (rezultatAQL) {","\t\t    \t\tvar poizvedba = rezultatAQL.resultSet;","\t\t    \t\tvar rezultat = \"\";","\t\t\t\t\tvar ITM;","\t\t\t        for (var i in poizvedba) {","\t\t\t        \t\trezultat += \"<div class='stanje ' id='vTemp'>Temperatura: <span class=''>\" + poizvedba[i].temperatura + \"</span> °C</div>\";","\t\t\t        \t\trezultat += \"<div class='stanje' id='vSis'>Sistolični tlak: <span class=''>\" + poizvedba[i].sis_tlak + \"</span> mmHH</div>\";","\t\t\t        \t\trezultat += \"<div class='stanje' id='vDias'>Diastolični tlak tlak: <span class=''>\" + poizvedba[i].dias_tlak + \"</span> mmHH</div>\";","\t\t\t        \t\trezultat += \"<div class='stanje label-normalno' id='vTeza'>Telesna teža: <span class=''>\" + poizvedba[i].teza + \"</span> kg</div>\";","\t\t\t        \t\trezultat += \"<div class='stanje label-normalno' id='vVisina'>Telesna višina: <span class=''>\" + poizvedba[i].visina + \"</span> cm</div>\";","\t\t\t        \t\tITM = poizvedba[i].teza/(poizvedba[i].visina*poizvedba[i].visina/10000);","\t\t\t\t\t\t\trezultat += \"<div class='stanje' id='vITM'>Indeks telesne mase: <span class=''>\" + ITM.toFixed(2) + \"</span></div>\";","","\t\t\t        }","\t\t\t\t\t","\t\t\t\t\t","\t\t\t\t\tvar status;","\t\t\t\t\tif(ITM<18.4) status=1;","\t\t\t\t\telse if(ITM>18.5 && ITM<24.9) status=0;","\t\t\t\t\telse if(ITM>25.0 && ITM<29.9) status=1;","\t\t\t\t\telse if(ITM>30.0 && ITM<34.9) status=2;","\t\t\t\t\telse if(ITM>35.0 && ITM<39.9) status=3;","\t\t\t\t\telse status=4;","\t\t\t\t\t","","\t\t\t        // Pogoji","\t\t\t        $(\"body\").bind(\"DOMNodeInserted\", function() {","\t\t\t\t\t\t   if (poizvedba[0].temperatura > 37.0 || poizvedba[0].temperatura<35.0 )","\t\t\t\t\t        \t$(\"#vTemp\").addClass(\"label-opozorilo\");","\t\t\t\t\t       else $(\"#vTemp\").addClass(\"label-normalno\");","\t\t\t\t\t\t   ","\t\t\t\t\t\t   if (poizvedba[0].sis_tlak > 180 || poizvedba[0].sis_tlak<100 )","\t\t\t\t\t        \t$(\"#vSis\").addClass(\"label-opozorilo\");","\t\t\t\t\t       else $(\"#vSis\").addClass(\"label-normalno\");","\t\t\t\t\t\t   ","\t\t\t\t\t\t   if (poizvedba[0].dias_tlak > 90 || poizvedba[0].dias_tlak<45 )","\t\t\t\t\t        \t$(\"#vDias\").addClass(\"label-opozorilo\");","\t\t\t\t\t       else $(\"#vDias\").addClass(\"label-normalno\");","\t\t\t\t\t\t   ","\t\t\t\t\t\t   if(status==0) $(\"#vITM\").addClass(\"label-zelena\");","\t\t\t\t\t\t   if(status==1) $(\"#vITM\").addClass(\"label-rumena\");","\t\t\t\t\t\t   if(status==2) $(\"#vITM\").addClass(\"label-oranzna\");","\t\t\t\t\t\t   if(status==3) $(\"#vITM\").addClass(\"label-opozorilo\");","\t\t\t\t\t\t   if(status==4) $(\"#vITM\").addClass(\"label-opozorilo\");","\t\t\t\t\t\t   ","\t\t\t\t\t\t   ","\t\t\t\t\t});","\t\t\t\t\t","\t\t\t\t\t$(\"#postavidiagnozo\").click(function(){","\t\t\t\t\tanaliziraj(poizvedba[0].temperatura,status);","\t\t\t\t\t});","\t\t\t\t\t","\t\t\t        $(\"#podatkiMeritev\").html(rezultat);","\t\t    \t} else {","\t\t    \t\t$(\"#podatkiMeritev\").html(\"Ni podatkov!\");","\t\t    \t}","","\t\t    },","\t\t    error: function(err) {","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t    }","\t\t});","}","","function analiziraj(temperatura,itm){","\tvar tezava1 = $('input:radio[name=prebava]').filter(\":checked\").val();","\tvar tezava2 = $('input:radio[name=utrujenost]').filter(\":checked\").val();","\tvar tezava3 = $('input:radio[name=bolecine]').filter(\":checked\").val();","\tvar tezava4 = $('input:radio[name=zelodec]').filter(\":checked\").val();","\tvar tezava5 = $('input:radio[name=glavobol]').filter(\":checked\").val();","\tvar bolehanje = $('#dnevi').val();","\t","\tvar tezave = tezava1+tezava2+tezava3+tezava4+tezava5;","\tvar nevarnadrzava = $('#seznamDrzav :selected').index();","\t","\tvar sporocilo;","\t","\tif(nevarnadrzava !=0 && tezave>=2 && temperatura>38)","\t\tsporocilo = \"Lahko bolehate za \" + recentDiseases[nevarnadrzava]+ \". Čimprej se posvetujte z vašim osebnim zdravnkiom in pozorno spremljajte simptome.\";","\telse if(tezave>=3 && temperatura>38) {","\t\tif(bolehanje<=4)","\t\tsporocilo =\"Svetujemo, da pocakate še nekaj dni. Če se stanje ne izboljšajo pojdite k osebnem zdravniku.\";","\t\telse","\t\tsporocilo =\"Čimprej se posvetujte z vašim osebnim zdravnikom.\";","\t}","\telse if(temperatura<37 && tezave<=2 && itm!=0 )","\tsporocilo=\"Ste zdravi, dobro se spočite in zaužite veliko vode. Vaš index telesne teže odstopa od povprečnega zato so vaše težave lahko povezane z telesno težo. Če se simptomi nadaljujejo se posvetujte z vašim osebnim zdravnikom.\";","\telse ","\tsporocilo=\"Ste popolnoma zdravi. Kar tako naprej.\";","\t","\t","\t$(\"#postavitevDiagnozeOpozorilo\").hide();","\t","\t$(\"#rezultatDiagnoze\").html(sporocilo);","}","","/*var AQL = \"select\"+","    \"a_a/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude as temperatura,\" +","    \"a/context/start_time/value as context_start_time\" +","\"from EHR e[ehr_id/value='\"+ehrID+\"']\"+","\"contains COMPOSITION a\"+","\"contains OBSERVATION a_a[openEHR-EHR-OBSERVATION.body_temperature.v1]\"+","\"order by a/context/start_time desc\"+","\"offset 0 limit 6\";*/","","","","function homeInit(pocisti)","{","\tlistOfCountries = [];","\trecentDiseases = [];","\t$(\"#seznamDrzav\").html(\"\");","\t$(\"#trenutneBolezniSporocilo\").html(\"\");","\t\t","\t$.getJSON('http://whateverorigin.org/get?url=' + ","\t\tencodeURIComponent('http://www.hpsc.ie/A-Z/Vectorborne/ViralHaemorrhagicFever/EndemicAreasandRecentOutbreaks/EndemicAreasListofdiseasesbycountry/') + ","\t\t'&callback=?', function(data){","","\t\thtmlContent = $.parseHTML(data.contents);","\t\thtmlContent = $(htmlContent).find(\".column1\").find(\"p:not(:last)\");","","","\t\tlistOfCountries.push(\"Nisem potoval (v zadnjih 3 mesecih)\");","\t\trecentDiseases.push(\"\");","\t\t$(htmlContent).each(function(index,result){","\t\t\tlistOfCountries.push($(result).find(\"strong\").text().slice(0,-1));","\t\t\t$(result).find(\"strong\").remove();","\t\t\trecentDiseases.push($(result).text());","\t\t});","","\t\tlistOfCountries.forEach(function(podatek) {","\t\t\t$(\"#seznamDrzav\").append('<option value=\"\">' + podatek + '</option>');","\t\t});","\t});","\t","\t$(\"#seznamDrzav\").change(function() {","\t    var sporocilo = recentDiseases[$(\"#seznamDrzav\").find(\":selected\").index()];","\t\tif (sporocilo.length != 0)","\t\t\t$(\"#trenutneBolezniSporocilo\").html('<div id=\"trenutneBolezni\" class=\"alert alert-warning\" role=\"alert\">'+ \"Zadnje znane okužbe: \" + sporocilo + '</div>');","\t\telse ","\t\t\t$(\"#trenutneBolezniSporocilo\").html(\"\");","\t});","","\tif (!pocisti) $(\"#kartoteka,#diagnoza\").hide();","}","","$(document).ready(function(){","\thomeInit();","\t$(\"#kartoteka,#diagnoza\").hide();","","\t$(\"#title\").hide();","    $(\"#title\").show( \"blind\", {direction: \"horizontal\"}, 2000 );","","\t$(\"a[href*=a]\").click(function(e) {","\t    e.preventDefault();","\t    window.open(\"index.html\",\"_self\");","\t    homeInit();","\t});  ","\t$(\"a[href*=b]\").click(function(e) {","\t    e.preventDefault();","\t    window.open(\"generator.html\",\"_self\");","\t}); ","\t$(\"a[href*=c]\").click(function(e) {","\t    e.preventDefault();","\t    alert('Still in progress');","\t}); ","","\t$(\"#pocisti1\").click(function()","\t{","\t\t$(\"#sporociloVnosEHR,#obvestiloEHR\").html(\"\");","\t});","","\t$(\"#pocisti2\").click(function()","\t{","\t    $(\"#sporociloVnosVitalnihPodatkov\").html(\"\");","\t});","","\t$(\"#pocisti\").click(function()","\t{","\t    homeInit(true);","\t});","","\t$(\"#datumrojstva\").datepicker({","\t\tchangeMonth: true,","\t\tchangeYear: true,","\t\tyearRange: \"1950:2014\",","\t\tdateFormat: \"yy-mm-dd\",","\t\tonSelect: function(dateText, inst) {","\t\t\t$(\"input[name='datumRojstva']\").val(dateText);","\t\t}","    });","","    $(\"#datummeritve\").datepicker({","\t\tchangeMonth: true,","\t\tchangeYear: true,","\t\tyearRange: \"1950:2014\",","\t\tdateFormat: \"yy-mm-dd\",","","\t\tonSelect: function(dateText, inst) {","\t\t\t$(\"input[name='datumMeritve']\").val(dateText);","\t\t},","    });","","    $(\"#ogledKartoteke\").click(function()","\t{","\t\tpreberiEHR();","\t});","","\t$(\"#seznamUporabnikov\").change(function(index) {","\t\t$(\"#pacientEHR\").val($('#seznamUporabnikov').val());","\t});","});","","function getAge(dateString) ","{","    var today = new Date();","    var birthDate = new Date(dateString);","    var age = today.getFullYear() - birthDate.getFullYear();","    var m = today.getMonth() - birthDate.getMonth();","    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;","    return age + \" let\";","}","",""]},{"start":{"row":0,"column":0},"end":{"row":501,"column":0},"action":"insert","lines":["var baseUrl = 'https://rest.ehrscape.com/rest/v1';","var queryUrl = baseUrl + '/query';","","var username = \"ois.seminar\";","var password = \"ois4fri\";","","var listOfCountries = [];","var recentDiseases = [];","","function getSessionId() {","    var response = $.ajax({","        type: \"POST\",","        url: baseUrl + \"/session?username=\" + encodeURIComponent(username) +","                \"&password=\" + encodeURIComponent(password),","        async: false","    });","    return response.responseJSON.sessionId;","}","","function seznamUporabnikov()","{","\t","\t$(\"#seznamUporabnikov\").append('<option value=\"3760de76-c6fb-4adf-bab7-af701004543a\">Zorko Chen</option>');","\t$(\"#seznamUporabnikov\").append('<option value=\"63feb995-19bc-450f-99a7-0110ba3772a2\">Jozefa Zhao</option>');","\t$(\"#seznamUporabnikov\").append('<option value=\"30d29261-0f7e-4ffc-9ed4-aa2b50621cae\">Valburga Liang\t</option>');","}","","function kreirajEHR()  {","\tsessionId = getSessionId();","\t","\tvar ime = $(\"#ime\").val();","\tvar priimek = $(\"#priimek\").val();","\tvar datumRojstva = $(\"#datumRojstva\").val();","\tvar casRojstva = $(\"#casRojstva\").val();","\tvar spol = $('input:radio[name=gender]').filter(\":checked\").val();","","\tif (!ime || !priimek || !datumRojstva || !casRojstva || ime.trim().length == 0 || priimek.trim().length == 0 || datumRojstva.trim().length == 0 || casRojstva.trim().length == 0) {","\t\t$(\"#sporociloVnosEHR\").html(\"<span class='obvestilo label label-danger'>Izpolnite vsa polja!</span>\");","\t\treturn false;","\t}","\telse","\t{","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\t$.ajax({","\t\t    url: baseUrl + \"/ehr\",","\t\t    type: 'POST',","\t\t    success: function (data) {","\t\t        var ehrId = data.ehrId;","\t\t        var partyData = {","\t\t            firstNames: ime,","\t\t            lastNames: priimek,","\t\t            gender:spol + \"\",","\t\t            dateOfBirth: datumRojstva+\"T\"+casRojstva,","\t\t            partyAdditionalInfo: [{key: \"ehrId\", value: ehrId}]","\t\t        };","\t\t        $.ajax({","\t\t            url: baseUrl + \"/demographics/party\",","\t\t            type: 'POST',","\t\t            contentType: 'application/json',","\t\t            data: JSON.stringify(partyData),","\t\t            success: function (party) {","\t\t                if (party.action == 'CREATE') {","\t\t                    $(\"#obvestiloEHR\").html('<div class=\"alert alert-success\" role=\"alert\">Uspešno kreiran EHR: ' + ehrId + '</div>');","\t\t                    $(\"#ehrID\").val(ehrId);","\t\t                }","\t\t                return true;","\t\t            },","\t\t            error: function(err) {","\t\t            \t$(\"#obvestiloEHR\").html('<div class=\"alert alert-danger\" role=\"alert\"> Napaka pri ustvarjanju EHR: ' + JSON.parse(err.responseText).userMessage + \"!\");","\t\t            \treturn false;","\t\t            }","\t\t        });","\t\t    }","\t\t});","\t}","}","","function preberiEHR() {","\tsessionId = getSessionId();","","\tvar ehrId = $(\"#pacientEHR\").val();","\tif (!ehrId || ehrId.trim().length == 0) $(\"#obvestiloEHR\").html('<div class=\"alert alert-warning\" role=\"alert\"> Vnesite vse zahtevane podatke!</div>');","\telse ","\t{","\t\t$.ajax({","\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",","\t\t\ttype: 'GET',","\t\t\theaders: {\"Ehr-Session\": sessionId},","\t    \tsuccess: function (data) {","\t\t\t\tvar podatki = data.party;","\t\t\t\tvar starost = getAge(podatki.dateOfBirth);","\t\t\t\tvar spol = podatki.gender == \"MALE\" ? \"Moški\" : \"Ženska\";","\t\t\t\t$(\"#ime\").html(\"<strong>\" + podatki.firstNames + \"</strong>\");","\t\t\t\t$(\"#priimek\").html(\"<strong>\" + podatki.lastNames + \"</strong>\");","\t\t\t\t$(\"#spol\").html(\"<strong>\" + spol + \"</strong>\");","\t\t\t\t$(\"#starost\").html(\"<strong>\" + starost + \"</strong>\");","\t\t\t\t$(\"#obvestiloEHR\").html(\"\");","\t\t\t\t$(\"#kartoteka\").slideDown();","\t\t\t\t$(\"#diagnoza\").slideDown();","\t\t\t\tpreberiMeritve(ehrId);","\t\t\t\tnarisiGraf(ehrId);","\t\t\t},","\t\t\terror: function(err) {","\t\t\t\t$(\"#obvestiloEHR\").html('<div class=\"alert alert-danger\" role=\"alert\"> Napaka pri branju EHR: ' + JSON.parse(err.responseText).userMessage + \"!\");","\t\t\t\t$(\"#kartoteka\").hide();","\t\t\t}","\t\t});","\t}","}","","function vnosVitalnihPodatkov()","{","\tsessionId = getSessionId();","\t","\tvar ehrId = $(\"#pacientEHR\").val();","\tvar temperatura = $(\"#temperatura\").val();","\tvar teza = $(\"#teza\").val();","\tvar visina = $(\"#visina\").val();","\tvar tlak = $(\"#tlak\").val().split(\"/\");","\tvar merilec = $(\"#merilec\").val();","\tvar datumMeritve = $(\"#datumMeritve\").val();","\tvar casMeritve = $(\"#casMeritve\").val();","","\t// Če merilec ni podan je to bolnik sam","\tif (merilec.trim().length == 0 || !merilec) merilec = ehrId;","","\tvar sistolicniTlak = tlak[0];","\tvar diastolicniTlak = tlak[1];","","","\tif (!ehrId ||","\t !temperatura ||","\t  !teza || ","\t  !visina || ","\t  !tlak || ","\t  ehrId.trim().length == 0 || ","\t  datumMeritve.trim().length == 0 || ","\t  !datumMeritve || ","\t  !casMeritve || ","\t  casMeritve.trim().length == 0 || ","\t  temperatura.trim().length == 0 || ","\t  teza.trim().length == 0 || ","\t  visina.trim().length == 0) {","\t\t$(\"#sporociloVnosVitalnihPodatkov\").html(\"<span class='obvestilo label label-danger'>Izpolnite vsa polja!</span>\");","\t}","\telse {","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","","\t\tvar podatki = {","\t\t    \"ctx/language\": \"en\",","\t\t    \"ctx/territory\": \"SI\",","\t\t    \"ctx/time\": datumMeritve+\"T\"+casMeritve,","\t\t    \"vital_signs/height_length/any_event/body_height_length\": visina,","\t\t    \"vital_signs/body_weight/any_event/body_weight\": teza,","\t\t   \t\"vital_signs/body_temperature/any_event/temperature|magnitude\": temperatura,","\t\t    \"vital_signs/body_temperature/any_event/temperature|unit\": \"°C\",","\t\t    \"vital_signs/blood_pressure/any_event/systolic\": sistolicniTlak,","\t\t    \"vital_signs/blood_pressure/any_event/diastolic\": diastolicniTlak","\t\t};","","\t\tvar parametri = {","\t\t    \"ehrId\": ehrId,","\t\t    templateId: 'Vital Signs',","\t\t    format: 'FLAT',","\t\t    committer: merilec","\t\t};","\t\t$.ajax({","\t\t    url: baseUrl + \"/composition?\" + $.param(parametri),","\t\t    type: 'POST',","\t\t    contentType: 'application/json',","\t\t    data: JSON.stringify(podatki),","\t\t    success: function (res) {","\t\t        $(\"#obvestiloVitalnihZnakov\").html('<div class=\"alert alert-success\" role=\"alert\">Meritve so bile uspešno vnesene</div>');","\t\t    },","\t\t    error: function(err) {","\t\t    \t$(\"#obvestiloVitalnihZnakov\").html('<div class=\"alert alert-danger\" role=\"alert\"> Napaka pri branju EHR: ' + JSON.parse(err.responseText).userMessage + \"!\");","\t\t    }","\t\t});","\t}","}","","function preberiMeritve(ehrId)","{","\tsessionId = getSessionId();\t","","\tvar AQL = ","\t\t\t\"select \" +","\t\t    \" a_a/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude as temperatura, \"+","\t\t    \" a_d/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude as sis_tlak, \"+","\t\t    \" a_d/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude as dias_tlak, \"+","\t\t    \" a_b/data[at0002]/events[at0003]/data[at0001]/items[at0004, 'Body weight']/value/magnitude as teza, \"+","\t\t    \" a_c/data[at0001]/events[at0002]/data[at0003]/items[at0004, 'Body Height/Length']/value/magnitude as visina \"+","\t\t\t\" from EHR e[ehr_id/value='\" + ehrId+ \"'] \"+","\t\t\t\" contains COMPOSITION a \"+","\t\t\t\" contains ( \"+","\t\t\t    \" OBSERVATION a_a[openEHR-EHR-OBSERVATION.body_temperature.v1] and \"+","\t\t\t    \" OBSERVATION a_b[openEHR-EHR-OBSERVATION.body_weight.v1] and \"+","\t\t\t    \" OBSERVATION a_c[openEHR-EHR-OBSERVATION.height.v1] and \"+","\t\t\t    \" OBSERVATION a_d[openEHR-EHR-OBSERVATION.blood_pressure.v1]) \"+","\t\t\t\" order by a/context/start_time desc \"+","\t\t\t\" offset 0 limit 1 \";","\t\t$.ajax({","\t\t    url: baseUrl + \"/query?\" + $.param({\"aql\": AQL}),","\t\t    type: 'GET',","\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t    success: function (rezultatAQL) {","\t\t    \tif (rezultatAQL) {","\t\t    \t\tvar poizvedba = rezultatAQL.resultSet;","\t\t    \t\tvar rezultat = \"\";","\t\t\t\t\tvar ITM;","\t\t\t        for (var i in poizvedba) {","\t\t\t        \t\trezultat += \"<div class='stanje ' id='vTemp'>Temperatura: <span class=''>\" + poizvedba[i].temperatura + \"</span> °C</div>\";","\t\t\t        \t\trezultat += \"<div class='stanje' id='vSis'>Sistolični tlak: <span class=''>\" + poizvedba[i].sis_tlak + \"</span> mmHH</div>\";","\t\t\t        \t\trezultat += \"<div class='stanje' id='vDias'>Diastolični tlak tlak: <span class=''>\" + poizvedba[i].dias_tlak + \"</span> mmHH</div>\";","\t\t\t        \t\trezultat += \"<div class='stanje label-normalno' id='vTeza'>Telesna teža: <span class=''>\" + poizvedba[i].teza + \"</span> kg</div>\";","\t\t\t        \t\trezultat += \"<div class='stanje label-normalno' id='vVisina'>Telesna višina: <span class=''>\" + poizvedba[i].visina + \"</span> cm</div>\";","\t\t\t        \t\tITM = poizvedba[i].teza/(poizvedba[i].visina*poizvedba[i].visina/10000);","\t\t\t\t\t\t\trezultat += \"<div class='stanje' id='vITM'>Indeks telesne mase: <span class=''>\" + ITM.toFixed(2) + \"</span></div>\";","","\t\t\t        }","\t\t\t\t\t","\t\t\t\t\t","\t\t\t\t\tvar status;","\t\t\t\t\tif(ITM<18.4) status=1;","\t\t\t\t\telse if(ITM>18.5 && ITM<24.9) status=0;","\t\t\t\t\telse if(ITM>25.0 && ITM<29.9) status=1;","\t\t\t\t\telse if(ITM>30.0 && ITM<34.9) status=2;","\t\t\t\t\telse if(ITM>35.0 && ITM<39.9) status=3;","\t\t\t\t\telse status=4;","\t\t\t\t\t","","\t\t\t        // Pogoji","\t\t\t        $(\"body\").bind(\"DOMNodeInserted\", function() {","\t\t\t\t\t\t   if (poizvedba[0].temperatura > 37.0 || poizvedba[0].temperatura<35.0 )","\t\t\t\t\t        \t$(\"#vTemp\").addClass(\"label-opozorilo\");","\t\t\t\t\t       else $(\"#vTemp\").addClass(\"label-normalno\");","\t\t\t\t\t\t   ","\t\t\t\t\t\t   if (poizvedba[0].sis_tlak > 180 || poizvedba[0].sis_tlak<100 )","\t\t\t\t\t        \t$(\"#vSis\").addClass(\"label-opozorilo\");","\t\t\t\t\t       else $(\"#vSis\").addClass(\"label-normalno\");","\t\t\t\t\t\t   ","\t\t\t\t\t\t   if (poizvedba[0].dias_tlak > 90 || poizvedba[0].dias_tlak<45 )","\t\t\t\t\t        \t$(\"#vDias\").addClass(\"label-opozorilo\");","\t\t\t\t\t       else $(\"#vDias\").addClass(\"label-normalno\");","\t\t\t\t\t\t   ","\t\t\t\t\t\t   if(status==0) $(\"#vITM\").addClass(\"label-zelena\");","\t\t\t\t\t\t   if(status==1) $(\"#vITM\").addClass(\"label-rumena\");","\t\t\t\t\t\t   if(status==2) $(\"#vITM\").addClass(\"label-oranzna\");","\t\t\t\t\t\t   if(status==3) $(\"#vITM\").addClass(\"label-opozorilo\");","\t\t\t\t\t\t   if(status==4) $(\"#vITM\").addClass(\"label-opozorilo\");","\t\t\t\t\t\t   ","\t\t\t\t\t\t   ","\t\t\t\t\t});","\t\t\t\t\t","\t\t\t\t\t$(\"#postavidiagnozo\").click(function(){","\t\t\t\t\tanaliziraj(poizvedba[0].temperatura,status);","\t\t\t\t\t});","\t\t\t\t\t","\t\t\t        $(\"#podatkiMeritev\").html(rezultat);","\t\t    \t} else {","\t\t    \t\t$(\"#podatkiMeritev\").html(\"Ni podatkov!\");","\t\t    \t}","","\t\t    },","\t\t    error: function(err) {","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t    }","\t\t});","}","","function analiziraj(temperatura,itm){","\tvar tezava1 = $('input:radio[name=prebava]').filter(\":checked\").val();","\tvar tezava2 = $('input:radio[name=utrujenost]').filter(\":checked\").val();","\tvar tezava3 = $('input:radio[name=bolecine]').filter(\":checked\").val();","\tvar tezava4 = $('input:radio[name=zelodec]').filter(\":checked\").val();","\tvar tezava5 = $('input:radio[name=glavobol]').filter(\":checked\").val();","\tvar bolehanje = $('#dnevi').val();","\t","\tvar tezave = tezava1+tezava2+tezava3+tezava4+tezava5;","\tvar nevarnadrzava = $('#seznamDrzav :selected').index();","\t","\tvar sporocilo;","\t","\tif(nevarnadrzava !=0 && tezave>=2 && temperatura>38)","\t\tsporocilo = \"Lahko bolehate za \" + recentDiseases[nevarnadrzava]+ \". Čimprej se posvetujte z vašim osebnim zdravnkiom in pozorno spremljajte simptome.\";","\telse if(tezave>=3 && temperatura>38) {","\t\tif(bolehanje<=4)","\t\tsporocilo =\"Svetujemo, da pocakate še nekaj dni. Če se stanje ne izboljša pojdite k osebnemu zdravniku.\";","\t\telse","\t\tsporocilo =\"Čimprej se posvetujte z vašim osebnim zdravnikom.\";","\t}","\telse if(temperatura<37 && tezave<=2 && itm!=0 )","\tsporocilo=\"Ste zdravi, dobro se spočijte in zaužite veliko vode. Vaš indeks telesne teže odstopa od povprečnega, zato so vaše težave lahko povezane z telesno težo. Če se simptomi nadaljujejo se posvetujte z vašim osebnim zdravnikom.\";","\telse ","\tsporocilo=\"Ste popolnoma zdravi. Kar tako naprej.\";","\t","\t","\t$(\"#postavitevDiagnozeOpozorilo\").hide();","\t","\t$(\"#rezultatDiagnoze\").html(sporocilo);","}","","function graf(podatki,sirina)","{","\tvar width = sirina ,barHeight = 30, height = 300;","\tconsole.log(sirina);","\tvar x = d3.scale.linear().range([0, width]);","\tvar y = d3.scale.linear().range([0, height]);","","\tvar chart = d3.select(\".chart\").attr(\"width\", width);","","\tdata = podatki;","","\tx.domain([0, d3.max(data, function(d) { return d.value; })]);","\ty.domain([0, d3.max(data,function(d) {return d.date; })]);","","","\tchart.attr(\"height\", barHeight * data.length);","","\tvar bar = chart.selectAll(\"g\").data(data).enter().append(\"g\").attr(\"transform\", function(d, i) { return \"translate(0,\" + i * barHeight + \")\"; });","\tbar.append(\"rect\").attr(\"width\", function(d) { return x(d.value); }).attr(\"height\", barHeight - 2);","\tbar.append(\"text\")","\t  \t.attr(\"x\", \"5px\")","\t  \t.style(\"text-anchor\",\"start\")","\t\t.attr(\"y\", barHeight / 2)","\t\t.text(function(d) { return d.date; });","","\t  bar.append(\"text\")","\t      .attr(\"x\", function(d) { return x(d.value) - 15; })","\t      .attr(\"y\", barHeight / 2)","\t      .attr(\"dy\", \".35em\")","\t      .text(function(d) { return d.value + \" °C\"; });","","\tfunction type(d) {","\t  d.value = +d.value;","\t  return d;","\t}","}","","var data = [];","function narisiGraf(ehrID)","{","\tsessionId = getSessionId();\t","","\tvar AQL = \"select \"+","\t    \" a_a/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude as temperatura, \" +","\t    \" a/context/start_time/value as cas \" +","\t\t\" from EHR e[ehr_id/value='\"+ehrID+\"'] \"+","\t\t\" contains COMPOSITION a \"+","\t\t\" contains OBSERVATION a_a[openEHR-EHR-OBSERVATION.body_temperature.v1] \"+","\t\t\" order by a/context/start_time desc \"+","\t\t\" offset 0 limit 6 \";","","\t$.ajax({","\t    url: baseUrl + \"/query?\" + $.param({\"aql\": AQL}),","\t    type: 'GET',","\t    headers: {\"Ehr-Session\": sessionId},","\t    success: function (rezultatAQL) {","\t    \t","\t    \tif (rezultatAQL) {","\t    \t\tvar poizvedba = rezultatAQL.resultSet;","\t    \t\tvar rezultat = []","\t\t        for (var i in poizvedba) {","\t\t\t\t\tdata.push({ ","\t\t\t        \"date\": (poizvedba[i].cas).toString().substring(0,16).replace(\"T\",\" \"),","\t\t\t        \"value\": (poizvedba[i].temperatura).toString(),","\t\t\t    \t});","\t\t        }","","\t\t\t\tgraf(data,$(\"#graf\").width());","","\t    \t} else {","\t    \t\t$(\"#grafTemperatur\").html(\"Ni podatkov!\");","\t    \t}","","\t    },","\t    error: function(err) {","\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t    }","\t});","","}","","","","","function homeInit(pocisti)","{","\tlistOfCountries = [];","\trecentDiseases = [];","\t$(\"#seznamDrzav\").html(\"\");","\t$(\"#trenutneBolezniSporocilo\").html(\"\");","\t\t","\t$.getJSON('http://whateverorigin.org/get?url=' + ","\t\tencodeURIComponent('http://www.hpsc.ie/A-Z/Vectorborne/ViralHaemorrhagicFever/EndemicAreasandRecentOutbreaks/EndemicAreasListofdiseasesbycountry/') + ","\t\t'&callback=?', function(data){","","\t\thtmlContent = $.parseHTML(data.contents);","\t\thtmlContent = $(htmlContent).find(\".column1\").find(\"p:not(:last)\");","","","\t\tlistOfCountries.push(\"Nisem potoval (v zadnjih 3 mesecih)\");","\t\trecentDiseases.push(\"\");","\t\t$(htmlContent).each(function(index,result){","\t\t\tlistOfCountries.push($(result).find(\"strong\").text().slice(0,-1));","\t\t\t$(result).find(\"strong\").remove();","\t\t\trecentDiseases.push($(result).text());","\t\t});","","\t\tlistOfCountries.forEach(function(podatek) {","\t\t\t$(\"#seznamDrzav\").append('<option value=\"\">' + podatek + '</option>');","\t\t});","\t});","\t","\t$(\"#seznamDrzav\").change(function() {","\t    var sporocilo = recentDiseases[$(\"#seznamDrzav\").find(\":selected\").index()];","\t\tif (sporocilo.length != 0)","\t\t\t$(\"#trenutneBolezniSporocilo\").html('<div id=\"trenutneBolezni\" class=\"alert alert-warning\" role=\"alert\">'+ \"Zadnje znane okužbe: \" + sporocilo + '</div>');","\t\telse ","\t\t\t$(\"#trenutneBolezniSporocilo\").html(\"\");","\t});","","\tif (!pocisti) $(\"#kartoteka,#diagnoza\").hide();","}","","$(document).ready(function(){","\thomeInit();","\t$(\"#kartoteka,#diagnoza\").hide();","\tseznamUporabnikov();","\t$(\"#title\").hide();","    $(\"#title\").show( \"blind\", {direction: \"horizontal\"}, 2000 );","","\t$(\"a[href*=a]\").click(function(e) {","\t    e.preventDefault();","\t    window.open(\"index.html\",\"_self\");","\t    homeInit();","\t});  ","\t$(\"a[href*=b]\").click(function(e) {","\t    e.preventDefault();","\t    window.open(\"generator.html\",\"_self\");","\t}); ","","\t$(\"#pocisti1\").click(function()","\t{","\t\t$(\"#sporociloVnosEHR,#obvestiloEHR\").html(\"\");","\t});","","\t$(\"#pocisti2\").click(function()","\t{","\t    $(\"#sporociloVnosVitalnihPodatkov\").html(\"\");","\t});","","\t$(\"#pocisti\").click(function()","\t{","\t    homeInit(true);","\t});","","\t$(\"#datumrojstva\").datepicker({","\t\tchangeMonth: true,","\t\tchangeYear: true,","\t\tyearRange: \"1950:2014\",","\t\tdateFormat: \"yy-mm-dd\",","\t\tonSelect: function(dateText, inst) {","\t\t\t$(\"input[name='datumRojstva']\").val(dateText);","\t\t}","    });","","    $(\"#datummeritve\").datepicker({","\t\tchangeMonth: true,","\t\tchangeYear: true,","\t\tyearRange: \"1950:2014\",","\t\tdateFormat: \"yy-mm-dd\",","","\t\tonSelect: function(dateText, inst) {","\t\t\t$(\"input[name='datumMeritve']\").val(dateText);","\t\t},","    });","","    $(\"#ogledKartoteke\").click(function()","\t{","\t\tpreberiEHR();","\t});","","\t$(\"#seznamUporabnikov\").change(function(index) {","\t\t$(\"#pacientEHR\").val($('#seznamUporabnikov').val());","\t});","});","","function getAge(dateString) ","{","    var today = new Date();","    var birthDate = new Date(dateString);","    var age = today.getFullYear() - birthDate.getFullYear();","    var m = today.getMonth() - birthDate.getMonth();","    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;","    return age + \" let\";","}",""]}]}]]},"ace":{"folds":[],"scrolltop":60,"scrollleft":0,"selection":{"start":{"row":501,"column":0},"end":{"row":501,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":3,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1419194927811,"hash":"2f8d2a484f02bb248dc501c05f475c142a385bcd"}